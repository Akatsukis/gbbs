<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/gbbs/blog/rss.xml" title="GBBS Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/gbbs/blog/atom.xml" title="GBBS Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><title data-react-helmet="true">KCore | GBBS</title><meta data-react-helmet="true" property="og:url" content="https://paralg.github.io/gbbs/docs/tutorial/kcore_tutorial"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="KCore | GBBS"><meta data-react-helmet="true" name="description" content="At this point, you should be familiar with some of the basic features"><meta data-react-helmet="true" property="og:description" content="At this point, you should be familiar with some of the basic features"><link data-react-helmet="true" rel="shortcut icon" href="/gbbs/img/graph.svg"><link data-react-helmet="true" rel="canonical" href="https://paralg.github.io/gbbs/docs/tutorial/kcore_tutorial"><link data-react-helmet="true" rel="alternate" href="https://paralg.github.io/gbbs/docs/tutorial/kcore_tutorial" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://paralg.github.io/gbbs/docs/tutorial/kcore_tutorial" hreflang="x-default"><link rel="stylesheet" href="/gbbs/assets/css/styles.fededd78.css">
<link rel="preload" href="/gbbs/assets/js/styles.dc38d310.js" as="script">
<link rel="preload" href="/gbbs/assets/js/runtime~main.3c022c42.js" as="script">
<link rel="preload" href="/gbbs/assets/js/main.39bf247a.js" as="script">
<link rel="preload" href="/gbbs/assets/js/1.a1ea751b.js" as="script">
<link rel="preload" href="/gbbs/assets/js/2.a380b37c.js" as="script">
<link rel="preload" href="/gbbs/assets/js/49.3701e664.js" as="script">
<link rel="preload" href="/gbbs/assets/js/50.069fe288.js" as="script">
<link rel="preload" href="/gbbs/assets/js/935f2afb.87b18d3b.js" as="script">
<link rel="preload" href="/gbbs/assets/js/17896441.821a1ac2.js" as="script">
<link rel="preload" href="/gbbs/assets/js/066397b0.0980bcbe.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/gbbs/"><img src="/gbbs/img/graph.svg" alt="GBBS Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gbbs/img/graph.svg" alt="GBBS Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">GBBS</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gbbs/docs/introduction">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gbbs/docs/library/overview">Library</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gbbs/docs/research">Publications and Resources</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/gbbs/docs/benchmarks/overview">Benchmark Implementations</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/ParAlg/gbbs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/gbbs/"><img src="/gbbs/img/graph.svg" alt="GBBS Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/gbbs/img/graph.svg" alt="GBBS Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">GBBS</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/gbbs/docs/introduction">Docs</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/gbbs/docs/library/overview">Library</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/gbbs/docs/research">Publications and Resources</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/gbbs/docs/benchmarks/overview">Benchmark Implementations</a></li><li class="menu__list-item"><a href="https://github.com/ParAlg/gbbs" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/introduction">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/install">Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/compile">Compile</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/run">Running Benchmarks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/formats">Graph Formats</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/python_bindings">Python Bindings</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/gbbs/docs/tutorial/bfs_tutorial">BFS</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/gbbs/docs/tutorial/kcore_tutorial">KCore</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Research</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/research">Publications and Resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/contributors">Contributors</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Library</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/library/overview">Overview</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Benchmark Implementations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/definitions">Definitions</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Shortest Path Problems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/breadth_first_search">BFS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/integral_weight_sssp">Integral-Weight SSSP (weighted BFS)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/positive_weight_sssp">Positive-Weight SSSP (Delta Stepping)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/general_weight_sssp">General-Weight SSSP (Bellman-Ford)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/ss_widest_path">Single-Source Widest Path</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/ss_betweenness_centrality">Single-Source Betweenness Centrality</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/sssp/spanner">Graph Spanner</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Connectivity Problems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/biconnectivity">Biconnectivity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/connectivity">Connectivity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/low_diameter_decomposition">Low Diameter Decomposition</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/minimum_spanning_forest">Minimum Spanning Forest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/spanning_forest">Spanning Forest</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/connectivity/strongly_connected_components">Strongly Connected Components</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Covering Problems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/covering/maximal_independent_set">Maximal Independent Set</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/covering/maximal_matching">Maximal Matching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/covering/graph_coloring">Graph Coloring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/covering/apx_set_cover">Approximate Set Cover</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Substructure Problems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/triangle_counting">Triangle Counting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/k_clique_counting">k-Clique Counting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/k_core">k-Core (Coreness)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/k_truss">k-Truss (Trussness)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/apx_densest_subgraph">Approximate Densest Subgraph</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/substructure/low_outdegree_orientation">Low-Outdegree Orientation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Eigenvector Problems</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/eigenvector/pagerank">PageRank</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/gbbs/docs/benchmarks/eigenvector/cosimrank">CoSimRank</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">KCore</h1></header><div class="markdown"><p>At this point, you should be familiar with some of the basic features
of the GBBS library such as the <code>vertexSubset</code> datatype and core parts
of the API such as <code>edgeMap</code>. For examples of how to use this, please
refer to either the <a href="/gbbs/docs/tutorial/bfs_tutorial">previous tutorial</a>
or the API reference.</p><p>In this tutorial, we will introduce and use other parts of the GBBS
library such as the <em>bucketing</em> data structure and the <code>nghCount</code>
primitive in order to compute the <em>k-core</em> of a graph. The
implementation we describe is presented in more detail in [1, 2].</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="definitions"></a>Definitions<a class="hash-link" href="#definitions" title="Direct link to heading">#</a></h3><p>Given <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G = (V, E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault">G</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:0.05764em">E</span><span class="mclose">)</span></span></span></span></span> the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>-core of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault">G</span></span></span></span></span> is the maximal set of vertices
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>⊂</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">S \subset V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72243em;vertical-align:-0.0391em"></span><span class="mord mathdefault" style="margin-right:0.05764em">S</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">⊂</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.22222em">V</span></span></span></span></span> s.t. the degree for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">v \in S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.05764em">S</span></span></span></span></span> in <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo stretchy="false">[</mo><mi>S</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">G[S]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">G</span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.05764em">S</span><span class="mclose">]</span></span></span></span></span> (the induced
subgraph of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault">G</span></span></span></span></span> over <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.05764em">S</span></span></span></span></span>) is at least <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>. These objects have been
useful in the study of social networks and bioinformatics, and have
natural applications in the visualization of complex networks.</p><div style="text-align:center"><img alt="kcore-figure" width="400" src="/gbbs/img/kcore/kcore_figure.svg"></div> <p>For instance in the figure above the 1-core consists of all vertices
with degree at least 1 (all of the vertices in this example). The
vertices in the 2-core are computed by recursively deleting vertices
with degree less than 2 until all vertices remaining have degree at
least 2. The 3-core is computed similarly, by deleting vertices with
degree less than 3. The largest core in this example is the
3-core.</p><p>In the <strong><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>-core problem</strong>, the goal is to produce a map, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mi>V</mi><mo>→</mo><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">f : V \rightarrow \mathbb{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em"></span><span class="mord mathdefault" style="margin-right:0.10764em">f</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.22222em">V</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68889em;vertical-align:0em"></span><span class="mord"><span class="mord mathbb">N</span></span></span></span></span></span> s.t. for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi><mo>∈</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">v \in V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.22222em">V</span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.10764em">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mclose">)</span></span></span></span></span> is the maximum core
that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span></span></span></span></span> is a part of. We refer to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.10764em">f</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mclose">)</span></span></span></span></span> as the <strong>coreness</strong> of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span></span></span></span></span>.
A commonly used measure is the <strong>degeneracy</strong> of a graph, which is
just the maximum non-empty core that <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault">G</span></span></span></span></span> supports.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-peeling-algorithm"></a>The Peeling Algorithm<a class="hash-link" href="#the-peeling-algorithm" title="Direct link to heading">#</a></h3><p>In this tutorial we will implement a parallel implementation of the
classic <em>peeling algorithm</em> due to Matula and Beck (1983) (the same
algorithm has been implicitly described in the work of Anderson and
Mayr (1984)).</p><p>The <strong>sequential peeling algorithm</strong> is very simple. It first
bucket-sorts vertices by their degree, and then repeatedly deletes the
minimum-degree vertex. The affected neighbors are moved to a new
bucket corresponding to their induced degree. As each edge in each
direction and each vertex is processed exactly once, the algorithm
runs in <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m + n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span> work.</p><p>We will implement a <strong>parallel peeling algorithm</strong> based on this idea.
The algorithm works as follows at a high level. It stores the vertices
in a set of <em>buckets</em> which correspond to their induced degree. In
each parallel step, the algorithm peels all vertices in the smallest
non-empty bucket (let this bucket number be <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>), and assigns these
vertices to have a coreness of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>. It then updates the induced
degrees of the neighbors of the peeled vertices, and moves them into a
bucket corresponding to their new induced degree. Note that if the
induced degree of a vertex falls below the current bucket being
peeled, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>, the vertex is moved to bucket <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03148em">k</span></span></span></span></span>. The algorithm
terminates once all vertices are peeled. Later we will argue that our
implementation of this algorithm runs in <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>m</mi><mo>+</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(m + n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right:0.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span> expected work and
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>ρ</mi><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\rho \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.02778em">O</span><span class="mopen">(</span><span class="mord mathdefault">ρ</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mop">lo<span style="margin-right:0.01389em">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span> depth w.h.p. where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding="application/x-tex">\rho</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord mathdefault">ρ</span></span></span></span></span> is the <strong>peeling
complexity</strong> of the graph, defined as the number of rounds to peel the
graph to an empty graph where each peeling step removes all minimum
degree vertices.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="getting-started"></a>Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">#</a></h3><p>Let&#x27;s get started! <code>cd</code> into the <code>/benchmarks/kcore/</code> directory and
create a new directory called <code>kcore_tutorial</code>. Create three files in
this directory: <code>BUILD</code>, <code>KCore.cc</code> and <code>KCore.h</code>. We will start by
filling in some easy content in the <code>BUILD</code> and <code>KCore.cc</code> files.</p><p>Add the following to the <code>BUILD</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token function" style="color:rgb(111, 66, 193)">cc_library</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  name </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;KCore&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  hdrs </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;KCore.h&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  deps </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token string">&quot;//gbbs:gbbs&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token string">&quot;//gbbs:julienne&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">cc_binary</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  name </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token string">&quot;KCore_main&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  srcs </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;KCore.cc&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  deps </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;:KCore&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">package</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  default_visibility </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token string">&quot;//visibility:public&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And add the following to the <code>KCore.cc</code> file.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">include</span><span class="token macro property"> </span><span class="token macro property string">&quot;KCore.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">namespace</span><span class="token plain"> gbbs </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">double</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">KCore_runner</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> commandLine P</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  size_t num_buckets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> P</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">getOptionLongValue</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token string">&quot;-nb&quot;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">16</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### Application: KCore&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### Graph: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> P</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">getArgument</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### Threads: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">num_workers</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### n: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">n </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### m: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">m </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### Params: -nb (num_buckets) = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> num_buckets </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### ------------------------------------&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  timer t</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">start</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> cores </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">KCore</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> num_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">double</span><span class="token plain"> tt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">stop</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### Running Time: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> tt </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> tt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace gbbs</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token function" style="color:rgb(111, 66, 193)">generate_symmetric_main</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">gbbs</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">KCore_runner</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">false</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Thus far we have simply set up the skeleton of the k-core
implementation. The runner program in <code>KCore.cc</code> specifies that it
runs on a symmetric graph (either compressed or uncompressed), and
requires a parameter called <code>num_buckets (-nb)</code> which we will discuss
shortly.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="implementing-the-parallel-peeling-algorithm"></a>Implementing the Parallel Peeling Algorithm<a class="hash-link" href="#implementing-the-parallel-peeling-algorithm" title="Direct link to heading">#</a></h2><p>Add the following skeleton to <code>KCore.h</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">pragma</span><span class="token macro property"> </span><span class="token macro property expression">once</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">include</span><span class="token macro property"> </span><span class="token macro property string">&quot;gbbs/gbbs.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">include</span><span class="token macro property"> </span><span class="token macro property string">&quot;gbbs/julienne.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">namespace</span><span class="token plain"> gbbs </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">inline</span><span class="token plain"> sequence</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">KCore</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> size_t num_buckets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">16</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> uintE n </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> D </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sequence</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">size_t i</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">get_vertex</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">out_degree</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>So far the code doesn&#x27;t do much. The signature for the <code>KCore</code>
function tells us that it accepts as input a graph and the number of
buckets, and returns a sequence of integers representing the coreness
number of each vertex. Inside the function body, the main point of
interest is the array <code>D</code>, which will store the coreness values. The
array initializes the coreness values to degree of each vertex in the
graph.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="initializing-the-bucketing-structure"></a>Initializing the Bucketing Structure<a class="hash-link" href="#initializing-the-bucketing-structure" title="Direct link to heading">#</a></h3><p>The next step in the algorithm before performing the peeling
computation is to initialize a <strong>bucketing structure</strong> that will
maintain a dynamic mapping between a set of identifiers (the vertices)
and their bucket (representing their current induced degree).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> B </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">make_vertex_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> increasing</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> num_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This declaration creates a bucketing structure, <code>B</code>, containing</p><ul><li><code>n</code> specifies the number of identifiers</li><li><code>D</code> specifies the mapping from identifier to its current bucket number</li><li><code>increasing</code> specifies that the buckets are processed in <em>increasing</em> order (smallest to largest)</li><li><code>num_buckets</code> specifies the number of <em>open buckets</em> to maintain</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="bucketing-nextbucket"></a>Bucketing: NextBucket<a class="hash-link" href="#bucketing-nextbucket" title="Direct link to heading">#</a></h3><p>Next, now that the bucketing structure is initialized, we will
implement the main peeling portion of the algorithm. The first step in
peeling is to loop while all vertices have not yet been processed, and
extract all of the vertices in the next non-empty bucket. Add the
following loop after the initialization of the bucketing structure, <code>B</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">uintE finished </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> rho </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> k_max </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">finished </span><span class="token operator" style="color:rgb(0, 92, 197)">!=</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> bkt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">next_bucket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> active </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">vertexSubset</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">move</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bkt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">identifiers</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  uintE k </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> bkt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  k_max </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  rho</span><span class="token operator" style="color:rgb(0, 92, 197)">++</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  finished </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> active</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">size</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>As described above, this code will loop until all vertices have been
peeled (when <code>finished == n</code>). Each step of the loop extracts the
identifiers in the next non-empty bucket using the <code>B.next_bucket()</code>
primitive. This primitive returns a <code>bucket</code> object which consists the
following:</p><ul><li><code>identifiers</code>: a sequence of identifiers contained in the extracted bucket</li><li><code>id</code>: the id of the extracted bucket</li></ul><p>The code first initializes a <code>vertexSubset</code> using the extracted
identifiers (vertices to be peeled), and increments the number of
finished vertices by the number of extracted identifiers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="updating-the-induced-degrees"></a>Updating the Induced Degrees<a class="hash-link" href="#updating-the-induced-degrees" title="Direct link to heading">#</a></h3><p>The next step is to compute the effect of peeling these vertices from
the graph has on their neighbors degrees. To do this we will use the
<code>nghCount</code> primitive provided by GBBS.</p><p>First add the following <code>EdgeMap</code> declaration after the initialization
of the bucket structure near the top of the function. This declaration
constructs a helper data-structure used to perform the <code>nghCount</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> em </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hist_table</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">make_tuple</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">UINT_E_MAX</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">m </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>nghCount</code> primitive takes as input</p><ul><li><code>G</code>: an input graph</li><li><code>active</code>: a <code>vertexSubset</code></li><li><code>cond_f</code>: a boolean function</li><li><code>apply_f</code>: a function from std::tuple&lt;uintE, uintE&gt; -&gt; std::optional&lt;std::tuple&lt;uintE, uintE&gt;&gt;</li><li><code>em</code>: a reference to the helper EdgeMap struct</li><li><code>flags</code>: an optional flags parameter</li></ul><p>It performs the following useful logic. It emits a value of <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em"></span><span class="mord">1</span></span></span></span></span> for
each edge <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(u,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathdefault">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mclose">)</span></span></span></span></span> where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>∈</mo><mrow><mi mathvariant="sans-serif">a</mi><mi mathvariant="sans-serif">c</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">v</mi><mi mathvariant="sans-serif">e</mi></mrow></mrow><annotation encoding="application/x-tex">u \in \mathsf{active}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em"></span><span class="mord mathdefault">u</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.67937em;vertical-align:0em"></span><span class="mord"><span class="mord mathsf">a</span><span class="mord mathsf">c</span><span class="mord mathsf">t</span><span class="mord mathsf">i</span><span class="mord mathsf" style="margin-right:0.01389em">v</span><span class="mord mathsf">e</span></span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><mrow><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">r</mi><mi mathvariant="sans-serif">u</mi><mi mathvariant="sans-serif">e</mi></mrow></mrow><annotation encoding="application/x-tex">C(v) = \mathsf{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault" style="margin-right:0.07153em">C</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:0.57143em;vertical-align:0em"></span><span class="mord"><span class="mord mathsf">t</span><span class="mord mathsf" style="margin-right:0.01389em">r</span><span class="mord mathsf">u</span><span class="mord mathsf">e</span></span></span></span></span></span>. Next, the mapped values for each such <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.03588em">v</span></span></span></span></span> are reduced
in parallel to obtain a single summed value, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>R</mi><mi>v</mi></msub></mrow><annotation encoding="application/x-tex">R_v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>. Finally, the
<code>apply_f</code> function is called on the pair <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><msub><mi>R</mi><mi>v</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v, R_v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> to obtain an
optional result <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi></mrow><annotation encoding="application/x-tex">O</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">O</span></span></span></span></span>. The vertex, augmented value pair <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>v</mi><mo separator="true">,</mo><mi>o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(v, o)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord mathdefault">o</span><span class="mclose">)</span></span></span></span></span> is
emitted to the output <code>vertexSubset</code> if and only if <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo>=</mo><mrow><mi mathvariant="sans-serif">S</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">m</mi><mi mathvariant="sans-serif">e</mi></mrow><mo stretchy="false">(</mo><mi>o</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O = \mathsf{Some}(o)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.02778em">O</span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathsf">S</span><span class="mord mathsf">o</span><span class="mord mathsf">m</span><span class="mord mathsf">e</span></span><span class="mopen">(</span><span class="mord mathdefault">o</span><span class="mclose">)</span></span></span></span></span> (i.e., a non-null option was returned).</p><div style="text-align:center"><img alt="kcore-figure" width="400" src="/gbbs/img/kcore/ngh_count.svg"></div> <p>For example, consider the figure above. The green vertices are the
vertices in <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">a</mi><mi mathvariant="sans-serif">c</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">v</mi><mi mathvariant="sans-serif">e</mi></mrow><annotation encoding="application/x-tex">\mathsf{active}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.67937em;vertical-align:0em"></span><span class="mord"><span class="mord mathsf">a</span><span class="mord mathsf">c</span><span class="mord mathsf">t</span><span class="mord mathsf">i</span><span class="mord mathsf" style="margin-right:0.01389em">v</span><span class="mord mathsf">e</span></span></span></span></span></span> in (1). Suppose <code>cond_f</code> returns
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">r</mi><mi mathvariant="sans-serif">u</mi><mi mathvariant="sans-serif">e</mi></mrow><annotation encoding="application/x-tex">\mathsf{true}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.57143em;vertical-align:0em"></span><span class="mord"><span class="mord mathsf">t</span><span class="mord mathsf" style="margin-right:0.01389em">r</span><span class="mord mathsf">u</span><span class="mord mathsf">e</span></span></span></span></span></span> for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>2</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>4</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>5</mn></msub></mrow><annotation encoding="application/x-tex">v_2, v_4, v_5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">4</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span> and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">f</mi><mi mathvariant="sans-serif">a</mi><mi mathvariant="sans-serif">l</mi><mi mathvariant="sans-serif">s</mi><mi mathvariant="sans-serif">e</mi></mrow><annotation encoding="application/x-tex">\mathsf{false}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em"></span><span class="mord"><span class="mord mathsf" style="margin-right:0.06944em">f</span><span class="mord mathsf">a</span><span class="mord mathsf">l</span><span class="mord mathsf">s</span><span class="mord mathsf">e</span></span></span></span></span></span> for <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>3</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>6</mn></msub></mrow><annotation encoding="application/x-tex">v_3, v_6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">6</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span></span>, and <code>apply_f</code> simply returns <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="sans-serif">S</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">m</mi><mi mathvariant="sans-serif">e</mi></mrow><mo stretchy="false">(</mo><msub><mi>R</mi><mi>v</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\mathsf{Some}(R_v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord"><span class="mord mathsf">S</span><span class="mord mathsf">o</span><span class="mord mathsf">m</span><span class="mord mathsf">e</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.00773em">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em"><span style="top:-2.5500000000000003em;margin-left:-0.00773em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.03588em">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>. The counts
associated with the red vertices in (2) show the vertices and their
associated values in the <code>int vertexSubset</code> that is emitted by the
<code>nghCount</code> primitive.</p><p>Now that we understand the semantics of <code>nghCount</code>, we can use it to
compute the number of neighbors removed from each vertex. The
<code>apply_f</code> function will simply take the number of removed neighbors
and perform the following steps:</p><ul><li>potentially update the coreness of this vertex in <code>D</code></li><li>return the new bucket that the neighbor should be moved to, or a
null option if the neighbor does not need to be moved</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> apply_f </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">tuple</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token operator" style="color:rgb(0, 92, 197)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">optional</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">tuple</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  uintE v </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">get</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token number">0</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> edgesRemoved </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">get</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token number">1</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  uintE deg </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">deg </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    uintE new_deg </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">max</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">deg </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> edgesRemoved</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> new_deg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">wrap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">get_bucket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">new_deg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">nullopt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> cond_f </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">vertexSubsetData</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> moved </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">nghCount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> cond_f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> apply_f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> no_dense</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that the code above makes use of the bucketing optimization
described in the Julienne paper [1]. Specifically, the implementation
is optimized for the case where only a small number of buckets are
processed, which is typically the case in practice. Thus, instead of
maintaining the identifiers stored in every single bucket, the
implementation only explicitly represents a prefix of the next <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.07153em">C</span></span></span></span></span>
many buckets, for some user-specified parameter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault" style="margin-right:0.07153em">C</span></span></span></span></span>.</p><p>The key point for our implementation is that we can potentially skip
updating the bucketing structure for many vertices that had their
degree decreased. To find out whether we need to actually move this
vertex to a bucket currently in the open range, , we call the
<code>B.get_bucket</code> primitive corresponding to the new bucket for this
vertex (<code>new_deg</code>). If the bucketing data structure does not need to
move this vertex from its current bucket to the bucket corresponding
to <code>new_deg</code> it returns a value of <code>UINT_E_MAX</code>, which the <code>wrap</code>
primitive then ignores by returning <code>std::nullopt</code>.</p><p>Note that the other reason that a neighbor may not need to move
buckets is if it has already been peeled.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="updating-the-buckets"></a>Updating the Buckets<a class="hash-link" href="#updating-the-buckets" title="Direct link to heading">#</a></h3><p>The last step is to update the bucketing data structure with the new
buckets for each of the affected neighbors.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">update_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">moved</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-finished-application"></a>The Finished Application<a class="hash-link" href="#the-finished-application" title="Direct link to heading">#</a></h2><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">pragma</span><span class="token macro property"> </span><span class="token macro property expression">once</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">include</span><span class="token macro property"> </span><span class="token macro property string">&quot;gbbs/gbbs.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="color:#e3116c">include</span><span class="token macro property"> </span><span class="token macro property string">&quot;gbbs/julienne.h&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">namespace</span><span class="token plain"> gbbs </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">template</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token keyword" style="color:#e3116c">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(227, 98, 9)">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token keyword" style="color:#e3116c">inline</span><span class="token plain"> sequence</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">KCore</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">Graph</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> size_t num_buckets </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">16</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> uintE n </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> D </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> sequence</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">size_t i</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">get_vertex</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">out_degree</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> B </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">make_vertex_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> increasing</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> num_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> em </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> hist_table</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">make_tuple</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">UINT_E_MAX</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">size_t</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain">G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">m </span><span class="token operator" style="color:rgb(0, 92, 197)">/</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  uintE finished </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> rho </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> k_max </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">finished </span><span class="token operator" style="color:rgb(0, 92, 197)">!=</span><span class="token plain"> n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> bkt </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">next_bucket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> active </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">vertexSubset</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">move</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">bkt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">identifiers</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    uintE k </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> bkt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    k_max </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    rho</span><span class="token operator" style="color:rgb(0, 92, 197)">++</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    finished </span><span class="token operator" style="color:rgb(0, 92, 197)">+=</span><span class="token plain"> active</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">size</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> apply_f </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">tuple</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token operator" style="color:rgb(0, 92, 197)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">optional</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">tuple</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      uintE v </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">get</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token number">0</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> edgesRemoved </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">get</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token number">1</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">p</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      uintE deg </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token keyword" style="color:#e3116c">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">deg </span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        uintE new_deg </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token function" style="color:rgb(111, 66, 193)">max</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">deg </span><span class="token operator" style="color:rgb(0, 92, 197)">-</span><span class="token plain"> edgesRemoved</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> new_deg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">wrap</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">get_bucket</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">new_deg</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">      </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">nullopt</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    </span><span class="token keyword" style="color:#e3116c">auto</span><span class="token plain"> cond_f </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">[</span><span class="token punctuation" style="color:rgb(36, 41, 46)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token keyword" style="color:#e3116c">const</span><span class="token plain"> uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&amp;</span><span class="token plain"> u</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">{</span><span class="token plain"> </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(0, 92, 197)">true</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    vertexSubsetData</span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;</span><span class="token plain">uintE</span><span class="token operator" style="color:rgb(0, 92, 197)">&gt;</span><span class="token plain"> moved </span><span class="token operator" style="color:rgb(0, 92, 197)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(111, 66, 193)">nghCount</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">        G</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> active</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> cond_f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> apply_f</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> em</span><span class="token punctuation" style="color:rgb(36, 41, 46)">,</span><span class="token plain"> no_dense</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    B</span><span class="token punctuation" style="color:rgb(36, 41, 46)">.</span><span class="token function" style="color:rgb(111, 66, 193)">update_buckets</span><span class="token punctuation" style="color:rgb(36, 41, 46)">(</span><span class="token plain">moved</span><span class="token punctuation" style="color:rgb(36, 41, 46)">)</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">cout </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot;### rho = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> rho </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> </span><span class="token string">&quot; k_{max} = &quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> k_max </span><span class="token operator" style="color:rgb(0, 92, 197)">&lt;&lt;</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(0, 92, 197)">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">  </span><span class="token keyword" style="color:#e3116c">return</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(36, 41, 46)">;</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain"></span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"></span><span class="token punctuation" style="color:rgb(36, 41, 46)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// namespace gbbs</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="compilation"></a>Compilation<a class="hash-link" href="#compilation" title="Direct link to heading">#</a></h2><p>Using Bazel you can compile the application the KCore application as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ bazel build //benchmarks/KCore/KCore_tutorial/...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To use <code>make</code> you can copy the makefile from
<code>benchmarks/KCore/JulienneDBS17/makefile</code>, and run <code>make</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testing"></a>Testing<a class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>Let&#x27;s try running our program on one of the test-inputs provided by Ligra in the <code>inputs/</code>
directory.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><div tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:rgb(36, 41, 46);background-color:#f6f8fa"><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">$ numactl -i all ./bazel-bin/benchmarks/KCore/KCore_tutorial/KCore_main \</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">    -s -rounds 4 inputs/rMatGraph_J_5_100</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># list_alloc init_blocks: 1000</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># after init:</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain"># Used: 0, allocated: 79872, node size: 16392, bytes: 1309261824</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### Application: KCore</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### Graph: inputs/rMatGraph_J_5_100</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### Threads: 144</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### n: 128</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### m: 708</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### Params: -nb (num_buckets) = 16 -fa (use fetch_and_add) = 0</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### ------------------------------------</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### rho = 21 k_{max} = 4</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">### Running Time: 0.000540018</span></div><div class="token-line" style="color:rgb(36, 41, 46)"><span class="token plain">...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The flags above indicate the following:</p><ul><li>The <code>-s</code> flag indicates that the graph is symmetric.</li><li>The <code>-rounds</code> flag indicates the number of times to run the benchmark.</li><li>The <code>-nb</code> flag indicates the number of open buckets the bucketing implementation should maintain.</li></ul><p>Great! We&#x27;ve successfully implemented a work-efficient k-core
algorithm in GBBS. You should now have all of the pieces necessary to
implement your own bucketing-based algorithms in GBBS.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="references"></a>References<a class="hash-link" href="#references" title="Direct link to heading">#</a></h2><p>[1] Laxman Dhulipala, Guy Blelloch, and Julian Shun<br>
<a href="https://ldhulipala.github.io/papers/Bucketing.pdf" target="_blank" rel="noopener noreferrer"><em>Julienne: A Framework for Parallel Graph Algorithms using Work-efficient Bucketing</em></a><br>
Proceedings of the ACM Symposium on Parallelism in Algorithms and Architectures (SPAA), pp. 293-304, 2017.</p><p>[2] Laxman Dhulipala, Guy Blelloch, and Julian Shun<br>
<a href="https://ldhulipala.github.io/papers/gbbs_topc.pdf" target="_blank" rel="noopener noreferrer"><em>Theoretically Efficient Parallel Graph Algorithms Can Be Fast and Scalable</em></a><br>
Proceedings of the ACM Symposium on Parallelism in Algorithms and Architectures (SPAA), pp. 393-404, 2018. <br></p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/gbbs/docs/tutorial/bfs_tutorial"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« BFS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/gbbs/docs/research"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Publications and Resources »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definitions" class="table-of-contents__link">Definitions</a></li><li><a href="#the-peeling-algorithm" class="table-of-contents__link">The Peeling Algorithm</a></li><li><a href="#getting-started" class="table-of-contents__link">Getting Started</a></li><li><a href="#implementing-the-parallel-peeling-algorithm" class="table-of-contents__link">Implementing the Parallel Peeling Algorithm</a><ul><li><a href="#initializing-the-bucketing-structure" class="table-of-contents__link">Initializing the Bucketing Structure</a></li><li><a href="#bucketing-nextbucket" class="table-of-contents__link">Bucketing: NextBucket</a></li><li><a href="#updating-the-induced-degrees" class="table-of-contents__link">Updating the Induced Degrees</a></li><li><a href="#updating-the-buckets" class="table-of-contents__link">Updating the Buckets</a></li></ul></li><li><a href="#the-finished-application" class="table-of-contents__link">The Finished Application</a></li><li><a href="#compilation" class="table-of-contents__link">Compilation</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a></li><li><a href="#references" class="table-of-contents__link">References</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/tutorial/bfs_tutorial">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/introduction">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/library/overview">Library</a></li><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/benchmarks/overview">Benchmark Specifications</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/contributors">Contributors</a></li><li class="footer__item"><a class="footer__link-item" href="/gbbs/docs/research">Publications and Resources</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Links</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/ParAlg/gbbs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 GBBS Authors.</div></div></div></footer></div>
<script src="/gbbs/assets/js/styles.dc38d310.js"></script>
<script src="/gbbs/assets/js/runtime~main.3c022c42.js"></script>
<script src="/gbbs/assets/js/main.39bf247a.js"></script>
<script src="/gbbs/assets/js/1.a1ea751b.js"></script>
<script src="/gbbs/assets/js/2.a380b37c.js"></script>
<script src="/gbbs/assets/js/49.3701e664.js"></script>
<script src="/gbbs/assets/js/50.069fe288.js"></script>
<script src="/gbbs/assets/js/935f2afb.87b18d3b.js"></script>
<script src="/gbbs/assets/js/17896441.821a1ac2.js"></script>
<script src="/gbbs/assets/js/066397b0.0980bcbe.js"></script>
</body>
</html>